<p>Gleicht alle Mitarbeiter aus der ERP View mit der topteam Tabelle tblAnsprechpartner.</p><div><div>-- =============================================</div><div>-- Author:<span class="Apple-tab-span" style="white-space:pre">		</span>Stefan BÃ¤tz, topfact AG</div><div>-- Create date: 14.10.2015</div><div>-- Description:<span class="Apple-tab-span" style="white-space:pre">	</span>Sync masterdata</div><div>-- =============================================</div><div>CREATE PROCEDURE [dbo].[Sync_DMS_Customer]</div><div>AS</div><div>BEGIN</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>SET NOCOUNT ON;</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DECLARE</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@erpid VARCHAR(50),&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@name nvarchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@group varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@street &nbsp;varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@zip varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@city varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@country varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@spec varchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@mandantid VARCHAR(10),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@status VARCHAR(100)</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DECLARE @mid INT</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DECLARE cur CURSOR FOR&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>SELECT</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>ACCOUNTNUM, NAME, CUSTGROUP, STREET, ZIPCODE, CITY, COUNTRY, CLASSIFICATIONGROUP,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>DATAAREAID, COMPANY_STATUS</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>FROM</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>[mssql.hq.tp.nil].[dax_2012r3_prod].[dbo].[VIEW_TRANSPOREON_DMS_CUSTOMER]</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>WHERE</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>ACCOUNTNUM IS NOT NULL OR LEN(ACCOUNTNUM)&gt;0;</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>OPEN cur</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>FETCH NEXT FROM cur&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>INTO @erpid, @name,@group,@street,@zip,@city,@country,@spec,@mandantid,@status</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>WHILE @@FETCH_STATUS = 0</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">	</span></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>SELECT @mid = MandantID FROM tblMandant WHERE (Nummer = @mandantid);</div><div><span class="Apple-tab-span" style="white-space:pre">		</span></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>IF EXISTS (SELECT * FROM topteam.dbo.tblFirma WHERE ERPID = @erpid)</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>UPDATE</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>topteam.dbo.tblFirma</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>SET</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>Name1 = @name,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>GroupName = @group,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>Strasse = @street,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>PLZ = @zip,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>Ort = @city,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>LKZ = @country,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>fk_tblFirmenspezifikation = (</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>CASE</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Carrier' THEN 1</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Shipper' THEN 7</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Supplier' THEN 2</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Corporate' THEN 3</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Institutions &amp; Public Authority' THEN 4</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Other' THEN 5</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @spec = 'Vendor' THEN 7</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>ELSE NULL END),</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>fk_tblFirmenStatus = (</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>CASE</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @status = 'Free for all' THEN 1</div><div><span class="Apple-tab-span" style="white-space:pre">							</span>WHEN @status = 'Blocked for all' THEN 2</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>ELSE NULL END),</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>MandantID = @mid,</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>DateModified = GETDATE()</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>WHERE</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(ERPID = @erpid)</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>END</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>ELSE</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>INSERT INTO topteam.dbo.tblFirma</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(ERPID, Suchwort, Name1, GroupName, Strasse, PLZ, Ort, LKZ, MandantID,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>fk_tblFirmenspezifikation, fk_tblFirmenStatus, DateInserted)</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>VALUES</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(@erpid,@erpid,@name,@group,@street,@zip,@city,@country,@mid,</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>CASE</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Carrier' THEN 1</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Shipper' THEN 7</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Supplier' THEN 2</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Corporate' THEN 3</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Institutions &amp; Public Authority' THEN 4</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Other' THEN 5</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @spec = 'Vendor' THEN 7</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>ELSE NULL END,<span class="Apple-tab-span" style="white-space:pre">					</span></div><div><span class="Apple-tab-span" style="white-space:pre">					</span>CASE</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @status = 'Free for all' THEN 1</div><div><span class="Apple-tab-span" style="white-space:pre">						</span>WHEN @status = 'Blocked for all' THEN 2</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>ELSE NULL END,</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>GETDATE())</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>END</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>FETCH NEXT FROM cur&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>INTO @erpid, @name,@group,@street,@zip,@city,@country,@spec,@mandantid,@status</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>END&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>CLOSE cur;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DEALLOCATE cur;</div><div><br /></div><div>END</div><div><br /></div><div>GO</div></div><div></div>