<p>Aktualisiert alle Mitarbeiterdaten in der topteam Tabelle tblAnsprechpartner.</p><div><div><div>CREATE PROCEDURE [dbo].[Sync_DMS_Emploees]</div><div>AS</div><div>BEGIN</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>SET NOCOUNT ON;</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DECLARE</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@fid INT,</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@anrede VARCHAR(50),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@nachname nvarchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@vorname nvarchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@username nvarchar(100),</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>@number nvarchar(100)</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DECLARE cur CURSOR FOR&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>SELECT</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>CASE</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 100 then 74402</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 101 then 36739</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 102 then 36740</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 103 then 36927</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 104 then 36928</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 105 then 36929</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 106 then 36930</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>when dataareaid = 107 then 36931</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>end as fid,</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>[AFFIX], [LASTNAME], [FIRSTNAME], [PERSONNELNUMBER] AS Username, [PERSONNELNUMBER] AS Number</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>FROM</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>[MSSQL.HQ.TP.NIL].[Dax_2012R3_Prod].[dbo].[VIEW_TRANSPOREON_DMS_EMPLOYEE];</div><div>&nbsp;&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>OPEN cur</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>FETCH NEXT FROM cur&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>INTO @fid, @anrede,@nachname,@vorname,@username,@number</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">	</span>WHILE @@FETCH_STATUS = 0</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">		</span></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>IF EXISTS (SELECT * FROM topteam.dbo.tblAnsprechpartner WHERE Number = @number)</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>UPDATE</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>topteam.dbo.tblAnsprechpartner</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>SET</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>Vorname = @vorname,&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>Nachname = @nachname,</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>fk_tblFirma = @fid,</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>datemodified = GETDATE()<span class="Apple-tab-span" style="white-space:pre">	</span></div><div><span class="Apple-tab-span" style="white-space:pre">				</span>WHERE</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(Number = @number)</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>END</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>ELSE</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>BEGIN</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>insert into topteam.dbo.tblAnsprechpartner</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(fk_tblFirma,Anrede,Nachname,Vorname,Username,Number,datecreated)</div><div><span class="Apple-tab-span" style="white-space:pre">				</span>VALUES</div><div><span class="Apple-tab-span" style="white-space:pre">					</span>(@fid, @anrede,@nachname,@vorname,@username,@number,GETDATE())</div><div><span class="Apple-tab-span" style="white-space:pre">			</span>END</div><div><br /></div><div><span class="Apple-tab-span" style="white-space:pre">		</span>FETCH NEXT FROM cur&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">		</span>INTO @fid, @anrede,@nachname,@vorname,@username,@number</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>END&nbsp;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>CLOSE cur;</div><div><span class="Apple-tab-span" style="white-space:pre">	</span>DEALLOCATE cur;</div><div><br /></div><div>END</div><div><br /></div><div>GO</div></div></div><div></div>