{
  "PageID": 11361,
  "PageGuid": "64781c83-9455-4d2b-9b97-e3b65109248c",
  "Title": "Update Mitarbeiterdaten",
  "Content": "Aktualisiert alle Mitarbeiterdaten in der topteam Tabelle tblAnsprechpartner.\r\nCREATE PROCEDURE [dbo].[Sync_DMS_Emploees]\r\nAS\r\nBEGIN\r\n\r\nSET NOCOUNT ON;\r\n\r\nDECLARE\r\n@fid INT,\r\n@anrede VARCHAR(50),\r\n@nachname nvarchar(100),\r\n@vorname nvarchar(100),\r\n@username nvarchar(100),\r\n@number nvarchar(100)\r\n\r\nDECLARE cur CURSOR FOR \r\nSELECT\r\nCASE\r\nwhen dataareaid = 100 then 74402\r\nwhen dataareaid = 101 then 36739\r\nwhen dataareaid = 102 then 36740\r\nwhen dataareaid = 103 then 36927\r\nwhen dataareaid = 104 then 36928\r\nwhen dataareaid = 105 then 36929\r\nwhen dataareaid = 106 then 36930\r\nwhen dataareaid = 107 then 36931\r\nend as fid,\r\n[AFFIX], [LASTNAME], [FIRSTNAME], [PERSONNELNUMBER] AS Username, [PERSONNELNUMBER] AS Number\r\nFROM\r\n[MSSQL.HQ.TP.NIL].[Dax_2012R3_Prod].[dbo].[VIEW_TRANSPOREON_DMS_EMPLOYEE];\r\n  \r\nOPEN cur\r\n\r\nFETCH NEXT FROM cur \r\nINTO @fid, @anrede,@nachname,@vorname,@username,@number\r\n\r\nWHILE @@FETCH_STATUS = 0\r\nBEGIN\r\nIF EXISTS (SELECT * FROM topteam.dbo.tblAnsprechpartner WHERE Number = @number)\r\nBEGIN\r\nUPDATE\r\ntopteam.dbo.tblAnsprechpartner\r\nSET\r\nVorname = @vorname, \r\nNachname = @nachname,\r\nfk_tblFirma = @fid,\r\ndatemodified = GETDATE() \r\nWHERE\r\n(Number = @number)\r\nEND\r\nELSE\r\nBEGIN\r\ninsert into topteam.dbo.tblAnsprechpartner\r\n(fk_tblFirma,Anrede,Nachname,Vorname,Username,Number,datecreated)\r\nVALUES\r\n(@fid, @anrede,@nachname,@vorname,@username,@number,GETDATE())\r\nEND\r\n\r\nFETCH NEXT FROM cur \r\nINTO @fid, @anrede,@nachname,@vorname,@username,@number\r\nEND \r\nCLOSE cur;\r\nDEALLOCATE cur;\r\n\r\nEND\r\n\r\nGO",
  "Url": "https://services.topfact.de/wiki/pages/view?g=64781c83-9455-4d2b-9b97-e3b65109248c"
}